#summary Program development log
= TopoLinux development log =


Change-log

20110301 Therion Point icons
made new icons for the therion points using 24x24 pixmaps
previous polygons are still in place under define OLD_POLYGON
The orientations can be arbitrary: define ORIENTATION_UNITS
specify the unit step.

20110226 PlotCanvas
Widget to edit therion point attributes: subtype, align, scale,
and a generic options. ThPoint2D has specific memmbers for subtype,
align and scale. The attributes are exported in the th2 file.
Introduced the member "text" for points (used as text for label, and
name for station).

20110225 PlotCanvas
Inactive scraps are denoted by yellow circles at the points
(area lines are not marked yet).
Changing scrap selection and entering a new scrap finishes any open
line/area.
Point options: clicking twice on a point does not move it but opens the
point subtype/options dialog.

20110223 PlotCanvas
Export of th2 with multiple scraps
multiple scraps show up in the PlotCanvas scrap drop down menu.

20110221 TherionScrap
a vector of scraps in the PlotStatus, with the possibility to add
new scraps (addScrap) and select the current scrap (th_scrap) by the name.
PlotCanvas: added widget to get the name of the new scrap.
add action for the scraps with menu the list of scrap names

20110216 TherionScrap
new class TherionScrap that collects points, lines and areas
This is the first step towards multiscrap plots.
for the time it is many plots, each with a single scrap.
plan to make many plots each with many scraps.
Each plot covers a portion of the data (case of several distinct passages
in the data) with possibly more than one scrap.

20110213 QTshot datalist
modifed autoincrement of station numbers so that they incresae
only by one whenever count > 1. TODO to check that is works.

20110207 QTshot aggregated "Save" and "Export" buttons.

20110207 Plot export as image (png) bedided as therion (.th2)

20110205 syntax uniformization:
trying to uniformize the method names to the Qt style.

20110204 Internationalization
Updated internationalizations "en" and "it".

20110204 Exporting the scrap names in the therion dat export.
Organizing the names: plot_name scrap_name file_name.
The scrap-name is used to set the file-name.
The names of the scraps/files are used to set the "survey commands"
in the data therion export if there is no command.
TODO Fixing the scrap export in PocketTopo (right now exports only the
first plot of the lists). see saveAsPocketTopo

20110202 Multille scrap plots
Started the support for multiple scraps. Right now there is a list of plan
plots and a list of extended plots. Each plot has a scrap. The scrap name must
be entered when the plot is created. Default names are provided, something
like "plan-1", the number is incremented at each new plot.
The plots are listed in drop-down menu lists attached at the plot buttons.
When a plot is hidden it can be shown by selecting its menu entry.

20110201 Plot grid at two resolutions
Plot grid with two resolutions:
1 m resolution (light gray)
10 m resolution (dark gray)
Below a certain zoom level (ZOOM_10) the 1m resolution is hidden.

20110130 New icons in Plot toolbar
new icons for select/point/line/area with drop-down menus
for the point/line/area type
Point orientation remain in the select menu.

20110128 Memory utility on windows.
Compiled a win32 project for dump_memory.
Uploaded the program (and addition win32 sources) on Topolinux website.

20110128 Area in the plot
Code for areas: water, snow, ice, and user
areas are ok - undo works somehow
An area is finished when another object is chosen (line, point, another 
area, or select).
Areas are editable like lines, and saved to the therion th2 file

20110120 Plot new features
Added therion points "stalagmite", "ice", "snow", "pebbles".
Also reorganized the PlotCanvas button and added shortcut menus to
the action "Mode" to switch among select/point/line
TODO to think about an area-water: a closed line (exported as type border)
with inside defined as the area 

20110120 Plot editing and PlotStatus
Make list of points and lines in PlotStatus private.
Fixed line redrwaing for PIT, CHIMNEY in line editing.
Added red dot to indicate the point that is moving, both
for Therion pointa and line points
Fixed a problem with scale and offset in Therion th2 export; must check it's ok

20110119 QTcalib on Windows
Compiled qtcalib (version 20110111) on windows, and updated download
area on topolinux.

20110118 Plot editing
added moving therion points and lines: press on the point and 
release on the new position.
Need to fix special lines: PIT, CHIMNEY (recompute brush)
Note: stations do not move.  

20110115 QTshot plot
preparing the plot for line editing, ie, moving line points.

20110111 QTshot on Windows
Compiled qtshot on Windows, uploaded on topolinux.

20110110 QTcalib 
Calibration result dialog diaplay also the Magn. dip angle, angle
between M and G.

20110109 calib
Fixed tlx_calib to input calib-coeff data files

20110109 QTcalib options
Added option whether to display compass/clino/roll raw or
transformed with the calibration transformation (coeff in CalibList).
This is initialized with the config parameter TRANSFORMED_DATA. 
Additional options:
  * Calibration maximum nr. of iterations 
  * Calibration threshold
Both these options are rather unimportant. The iteration number
rarely arrives to 100, and the threshold is multiplied by 10^-7
which is already small enough.

<code>
# NOTE  
# The individual measure calibration error is the angular difference
# between the data M-dip angle, and the average M-dip angle.
# The value of delta is
#       Delta = sqrt( 1/n * Sum(Err_j) )
# The calibration error is the maximum error
#       Eroor = max( Err_j )
</code>

20110107 QTcalib
Added guess tolerance angle in the Options widget
Added guess "angle" to CalibList read/load methods
Moved ComputeCompassAndClino() from CBlock to CTransform
(as a result CBlock.cpp is no longer needed)
Using the calibratiuon transformation to evaluate the coverage.

<code>
# 20110107 Realeased unstable TopoLinux 04
# with qtshot and qtcalib based on Qt4
</code>

20110106 QTcalib
Fixed bug in QTcalibWidget::value_changed()
Data calib coverage: added symbols for N, W, E, and +90 -90

20110104 PlotCanvas
There is too much confusion among points, lines and line-points:
they appear as graphics items and as therion items in separete places.
need to reorganize the information.

20110103 QTcalib
Fixed a few bugs and a segfault (upon loading a second calibfile:
fixed by destroying and creating a new datatable)

20110101 QTcalib 
Added Options button to select the rfcomm device.

20101231 Therion centerline export
Added sample thconfig to the export
Rewritten centerline exports (Therion, Survex and Compass
with ostringstream and QFile classes for portability.

20101229 QTcalib on Qt4
Unstable qtcalib: it works with additional features:
  * added roll display
  * group and roll are colored red and blue (data with no group are black)
  * coverage image is displayed red/green and the widget is improved

20101228 QTshot on Qt4
background image

20101226 Fixed 3D display on QT4
Fixed shot dialog(s) in qtshot, but the CommentDialog is too high:
need to make it shorter, or tabbed.
dropped "swap stations" option.
Set maximum height of HBoxWidget 30 (ITEM_HEIGHT)

20101210 New Class PlotCanvasScenei - Dropped PLotFrame
In the port of the plot onto Qt4 the scene is taken by the
new class PlotCanvasScene which inherits from QGraphicsScene
The PlotFrame is dropped as the olny function (computing the grid)
is moved in PlotStatus.
The scene organizes the garphics items in groups:
  * stations
  * centerline
  * splay
  * lrud TODO
  * grid
  * scalebar
  * points
  * lines

<code>
# 20101203 STARTED VERSION BASED ON Qt4
# The version on Qt3 is frozen now and no longer developed
# nor mantained.
</code>

20101121 control points for linepoints
Introduced new type ThLinePoint (first step towards control points).
Handle mouse release to set the control points (only symmetric CP for now),
however there is no visual feedback (curve is still polyline),
and not saved in therion th2 file. TODO. 

20101121 clean-up
Moved exportName from CenterlineInfo to SurveyInfo
Changed a few method names (from lowercase initial to uppercase)
Commented DBlock::MergeNext() and DBlock::Split()
Introduced DECLINATION_UNDEF
Added setters for DBlock distance, compass and clino
Made CanvasUndo into its own file (from PlotStatus.h) although the undo-list
is kept by the PlotStatus.
Renamed CanvasPoint to PlotPoint
Renamed CanvasSegment to PlotSegment

20101121 declination fixed
Fixed declination in therion export

20101023 bug Plot
Fixed bug Extend in Plot.cpp (was using Extended instead of Extend)

20101023 ExtendWidget
added the display of the shot data

20101023 Therion exports
commented "declination" must check therion command
check on the size of lines: 0,1 point lines are skipped

20101016 bug LabelWidget
LabelWidget crashed: instantiated on the stack and added call done() instead
of delete.

20101016 DataList 
new private method InitFromTo() to factorize the "from" "to" initialization.

20101012 memory
new directory "memory" for the command-line programs that deal with
the DistoX memory.

20101012 DistoX.h bug
Fixed a bug in the DistoX download method (qtcalib did not work).

20101012 config
fixed default config values in Config.h
several parameters have been introduced during development, but
the defaults have never been updated before.

20100913 Plot splay shot extend
Introduced new files CanvasExtend.h/cpp
changed the extend algo for splay shots: interpolate between the
extends of the two shots that bounds the interval of azimuths the
splay shot falls in.
If the point has only one centerline shot, use a ficticious opposite
direction with opposite extend.
NOTE what if the point has only one centerline shot and this is 
extend vertical ? The opposite direction is also vertical and the
extend of splay shots is undefined (set to vertcal).

20100906 Options
added option to set DistoX device (also settable by the downlowd dislog)

20100828 PlotCanvas
Added tool button to recompute centerline

20100806 PTfile and Num
PTfile: temporary changed the result of toString() for plain numbers 
MUST BE FIXED BACK LATER
Num had a bug in BranchNrMeasures, a missing test for NULL
which made MakeLoop segfault. 

20100722 DistoX QTshot
added test macros for the DistoX status byte
at the moment only GRAD, COMPASS, CALIB, SILENT are displayed,
but only CALIB and SILENT canbe changed by qtshot

20100530 QTshot support for DistoX modes
Added support for switching between calib and normal mode,
as well as between silent nad non-silent mode.
calib mode  = bit-3 set (0x08)
silent mode = bit-4 set (0x10)
Note my distox has 000s.c110

20100524 NUM
Fixed bug in Num.cpp (linking homotopy list)

20100506 CALIBRATION
included the implementation of beat's calibration algo in the distribution.
experimental algos not included.

20100426 POCKETTOPO and LRUD
made POCKETTOPO and LRUD support compile time options.
PocketTopo support not included in the distribution.

20100416 PLOT CANVAS BACKGROUND
fixed bug in PLotCanvas::doImage()

20100407 TABLE COLLAPSE
made the collapsed status of the table a property of the shot-widget.
when a new file is loaded the table is resetto expanded.

20100406 BASE BLOCK
fixed a bug in DataList (did not set base_block to NULL on clear).
The shot table display (QTshotWidget) retain the iconic pixmap
in the old cell when the base_block is changed, or when a new dataset
is loaded. Fixed a number of bugs connected with the existence of 
the base_block: it was not cleared on load.

20100402 UTILITIES
modified basic utility programs to keep into account the
roll data (byte 7).

20100401 EXPORT FUNCTIONS
extracted export functions fron DataList:
new files DataXXXExport.h and DataXXXExport.cpp

20100331 CBLOCK and CTRANSFORM
extracted CBlock and CTransform from CalibList.h into independent source
files

20100324 PLOT EXPORT
new class PlotExport with export info and methods

20100321 POCKETTOPO
support to read PocketTopo files.
class PTfile and ancillary classes.
all in a separate directory.
conditional compile with HAS_POCKETTOPO.
PocketTopo input/export seems to work, but requires more testing.

20100318 ROLL
start adding roll support
roll is read/written to TLX file (version 2)
manual block insert has roll=0
raw data file have roll=0
TLX data file version 1 has roll = 0.0 

20100318 DECLINATION
added declination.
the value of the declination is stored in the survey info.
it can be entered in the export survey info dialog.
it is used in all the exports.
by default it is zero (0)

20100305 THERION EXPORT
therion export
splay shots are being written with therion splay syntax,
ie, using dash '-' for the unnamed station.
splay shots are written all together after the centerline shots.

20100301 COMPASS EXPORT
station names in Compass export
station names in Compass are limited to 12 chars
the program issue a warning if there is a station name longer than 12 chars.
N.B. the file is written anyways, and must be saved again, because
it is not a proper compass file.
It is possible to choose between a single survey or multiple surveys in the file.

20100215
debian bluetooth setup with bluez:
using bluetooth-agent with PIN "0000"
made a script that runs the agent if not already running.
could system the script in qtshot/qtcalib or in Protocol.
(the agent can run under any user.) 

20100214 SERIAL COMMUNICATION
improved error messages in Serial.cpp
now can use the program Serial (compile Serial.cpp with -DTEST)
to check the communication with the DistoX

20100206 LRUD
LRUD are saved in TLX file and loaded from TLX files
LRUD are displayed in the plots (plan, extended, 3D have been checked)
x-section not checked yet.
LRUD are enabled only if the LRUD flags is set in config file.

20100205 (see 20100104) 
changed LRUD: made a struct to contain LRUD 
a DBlock has two LRUD: one at From (default), the other at To
  * they show in the shot dialog
  * LRUD widget has entries to change the LRUD for the from station and those for the to station is there is one.
  * shots with LRUD in the table have a '+' pixmap before the station name the plot baseshot has a circle with a cross (and arrows if LRUD too)
  * LRUD are exported in Therion if present in Compass they are exported or, if missing, LRUD are guessed from the splay shots in Survex must still do it

20100202 
fixed "units" bug in th exports
fixed "-text" bug in th2 save for label and continuation

20100128 NUM
converted num to C++
added the name of base station for the computation of the centerline

20100127 THERION POINT CONTINUATION
added terion point "continuation", symbol '?' 
takes a comment (option string)

20100126 EXPORT 
compass/survex export icons.
export info dialog customized to therion/compass/survex.
default export type taken by config file.
update help pages.

20100123 PLOT GRID
Grid spacing written on toolbar for the plots.
scale-bar and grid are alternative:
when the grid is hidden the scalbar is displayed and there is no label
with the grid spacing in the toolbar.

20100123 LOGO
compiled logo icons in the programs: not need to distribute icons directory

20100123 UNITS
fixed units (m/ft) also in the plot: scalebar and grid
default units selected in the config file.

20100123
added shifting of therion items upon recomputing the plot
because of changes of shot stations

20100123 EXPORT TYPE
made ExportType enum

20100123 COMMENTS
made the comment-size in the table a config parameter

20100122
Config handles values of string with white spaces, if enclosed by 
double quotes (0x22)

20100121 
compiled on Windows with MSVC 9.0 and Qt 4.6.0 
found how to deploy (with MS VC runtime installer)

20100120
extend estimate, might be ok.
the old function to estimate the "centerline extend" is still in the
code, but it is not used

20100118
plots stay centered on zoom in/out

20100115
fixed a coeff backup filename that is a new file.
the name is also proposed to the user in the "write" dialog.

20100113 LOCALE
Localized QTcalib

20100111 STATION NAMES in PLOT
Plot: toggle station numbers on/off
when off do not insert stations

20100109 VTHRESHOLD
horizontal cross-section: might be ok
V_THRESHOLD parameter in config file

20100109 LOCALE
Localize QTshot using QLocale class
QLocale locale( "it" );
double d = locale.toDouble( "..." ); // ignores leading and trailing spaces
int i = locale.toInt( "..." );
unsigned int ui = toUInt( "..." ); // can set the base too
QString s = locale.toString( d, 'g', 2 ); // precision=2

20100106
ExtendWidget, dialog for the "extend" flag in Extended plot
might have room also for the shot comment.
and apply to plan and 3D as well.

20100106 new struct Units for the units and respective factors
data are exported in therion and survex files in the
user units.

20100105 STATION COMMENTS 
station commenst are added to station selected in either
the Plan or the Extended plot 
Station commenst are saved in the th2 files
(3D viewer does not partecipate in this)

20100104 LRUD INSERT 
can add LRUD at From station and at To station
LRUD are stored as several splay shots
probably there is a better way to do this

20100101 DBLOCK
privatized DBlock (except for DataList which is friend)

20091231 CONFIG
config load parameters from different sources in row, so that
the last overwrite the previou definitions:
  * 1. global QTOPO_RC environment
  * 2. user home .qtopo.rc
  * 3. local qtopo.rc 

20091231 BUG
station crosses on the background did not follow the zoom

20091231 ORIENTATION EPXORT BUG
therion export: orientation ranged 0..7 (missed *45)

20091231 DATE and COMMENT
date and comment in TLX saved file

20091229 CLOSED LINES
  * added support for closed lines
  * added line type rock-border (color gray)
  * added ticks to lines pit and chimney
  * added arrow heads to line arrow
  * distibuished line by color
  * made plots persistent between calls
  * erase plots when a new centerline is loaded
  * ask date and description when data are downloaded
  * save/load date and description in TLX file

20091227 HELP
help in HTML format

20091226 INTERNATIONALIZATION
  * i18n for QTcalib
  * fix "Toggle" action for QTcalib
  * revise QTcalib messages
  * add exit confirm to QTcalib

20091226 BACKGROUND IMAGE
Background image: erase station / change station name
There is Edit/Remove dialog, but the changes are not reflected
on the display because the cross+name are printed in the original
image data

20091225
  * Fixed background image tiling the canvas, but it takes quite a while to compute background warped image. need a faster warping method
  * When the user does not enter the text in Background station selection, no point is added
  * Edit shot in QTshotWidget table: only one choice available at a time: properties, renumber, delete, insert, merge, split (each choice selection activate the corresponding choice)
  * Plot mode selection when the user chanegs point type, the point input mode is activated same for the line type and line input mode
  * QTshotWidget keeps pointers to the (last) four plots, one for each type. 
  * When the "extend" is changed for a shot, the change is propagated to the extended section plot (if any)
  *  Background station-point selection: (1) use cross-air cursor (2) mark points with cross and name (3) fixed the proper value of Y_OFFSET
  * IconSet manages also pens, shapes, arrows and brushes

20091224 INTERNATIONALIZATION
  * Made directory utils for Language and config
  * Language and config are singletons,
  * key-value lookup with operator()

When Plot is close, it ends the current line if needed. When it is opened again the line is completed, the UNDO reopens it and goes back, cancelling the line points. But the input mode is NOT changed to LINE, so that one can continue the line with another type.

20091224 FIXED: on undo the current line type is taked from the line

20091223 PLOT OFFSET
Fixed offx offy in PLotCanvas. When user is drawing a line and changes line type/draw mode the line is closed When Plot is closed and reopened the settings, zoom, shift etc. were lost. Fixed with a class PlotStatus. Plot: when a station has been selected for therion inhibit to select it again.

20091102 Added comment to TLX file format

20091224 New class PlotStatus: factorize saved plot status

20091224 Made buttons active/inactive: (feedbacks to user for what can be done and what not)

20091224 New class IconSet container of pixmaps

20091223 Changed name QTdata --> QTshot

200912   QTdata. Improved interface usability: uniformized icons colors, visual feedbacks (canvas mode cursors, canvas mode icon, flickering download icon)

20091215 New class Language: internationalization support (default en; first custom translation: it)

200911   Background sketches for the plots

20091004 QTcalib.
  * calib_list::loadData return number of read data
  * qtcalib added calibration description comment. The description is saved in calibration files after the data and is reloaded when the file is opened

20091003 calibration: included the pyramid (base Y-Z, vertex X) in hex_plot and Calibration. Not very useful in Calibration as the point of view cannot be changed

20091003 QTcalib: included write-coeff dialog with backup option for old coeffs. TODO coeff are backed up to file 'backup.txt' let the user input the name

20090930 QTcalib: TODO there is a problem with set-guess: sometimes there is no set change even though the angles are quite different

20090929 basic: new program dump2data.c It inspects a memory dump: writes info, extract unused (hot) data, etc.

20090915 distox QTdata QTcalib: support disto-log configuration option 

20080820 distox: created "distox" with the DistoX communication sources and Vector/Matrix

20080817 QTcalib. included the calibration class in the interface